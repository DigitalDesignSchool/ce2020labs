# Шаблон chip-expo-2021-template-2-plusarg

## Назначение

Шаблон демонстритует возможность одиночного и группового запуска тестов с передачей номера теста через командную строку симулятора и функцию $value$plusargs()

## Описание

В отличии от шаблона chip-expo-2021-template-1-param в данном варианте теста не доступна возможность установки различных компонентов и формирование параметров компонентов в зависимости от параметра test_id. Все компоненты и их параметры должны быть заданы. 

Основным преимуществом данного шаблона является необходимость только однократной компиляции и сборки исходных текстов проекта. Номер теста передаётся через командную строку симулятора и извлекается внутри теста при помощи функции $value$plusargs().

После завершения теста должен быть выполнен task test_finish(), в который передаётся номер теста, названия теста и результат теста, эти данные будут записаны в файл global.txt

Возможно два режима выполнения:
1. Запуск одиночного теста.
2. Запуск группы тестов

Запуск одиночного теста производится обычным образом. Должен быть снят выбор с поля "Use run.bash"; В поле  "Run option" надо добавить параметр -g test_id=<номер теста>. Выбранный тест будет запущен.

Запуск группового теста производится через файл run.bash; Необходимо поставить выбор на поле "Use run.bash" и скорректировать файл run.bash

Файл run.bash
    vlib work 
    vlog -writetoplevels questa.tops '-timescale' '1ns/1ns' design.sv testbench.sv  
    echo "" > global.txt
    vsim -f questa.tops  -batch -do "vsim -voptargs=+acc=npr ; run -all; exit" -voptargs=+acc=npr -g test_id=1
    vsim -f questa.tops  -batch -do "vsim -voptargs=+acc=npr ; run -all; exit" -voptargs=+acc=npr -g test_id=2
    vsim -f questa.tops  -batch -do "vsim -voptargs=+acc=npr ; run -all; exit" -voptargs=+acc=npr -g test_id=3
    cat global.txt

Строки которые начинаются с vsim запускают сеанс моделирования с заданным номером теста. Необходимо задать требуемые номера тестов.

## Настройка 

На сайт EDA надо добавить файл run.bash 

Установить симулятор Mentor Questa 2020.1

## Пример результата выполнения группы тестов

test_id=1     test_name:          test_1         TEST_PASSED
test_id=2     test_name:          test_2         TEST_FAILED *******
test_id=3     test_name:          test_3         TEST_FAILED *******

## Использование Vivado

Необходимо открыть терминал и перейти в каталог vivado. При работе в Visual Studio Code возможно использование встроенного терминала.

Необходимо настроить переменные окружения для работы в выбранной версии Vivado. Текущая версия 2021.1.

В каталоге vivado содержатся командные файлы:

* compile.sh - для компилирования исходных текстов
* elaborate.sh  - для сборки проекта 
* c_run_0.sh - запуск теста test_id=0 в консольном режиме
* c_run_1.sh - запуск теста test_id=1 в консольном режиме
* c_run_2.sh - запуск теста test_id=2 в консольном режиме
* c_run_3.sh - запуск теста test_id=3 в консольном режиме
* g_run_0.sh - запуск теста test_id=0 в режиме GUI
* g_run_1.sh - запуск теста test_id=1 в режиме GUI
* g_run_2.sh - запуск теста test_id=1 в режиме GUI
* g_run_3.sh - запуск теста test_id=1 в режиме GUI
* all.sh - компиляция, сборка и запуск всех тестов в консольном режиме 

При выборе запуска в режиме GUI будет запущен симулятор Vivado.  
При изменении исходного кода требуется повторная компиляция и сборка проекта. 
Если используется режим GUI, то окно Vivado надо закрыть и заново запустить симуляцию через файл g_run_<x>.sh

В файлах g_run_<x>.sh через параметр --view передаются имена файлов с временными диаграммами. Рекомендуется создать набор файлов временных диаграмм для собственного проекта.




